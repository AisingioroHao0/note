# 锁

## 锁的分类

- 共享锁 

  其他事务可以继续加共享锁，但不能增删改

- 排它锁，独占锁，写锁

  不允许其他事务操作这块资源

- 更新锁

  防止出现死锁的锁模式。一次只能分配给一个事务，如果需要对资源进行修改，更新锁会编程排它锁，否则变成共享锁

- 意向锁

  表示某些底层将上锁

- 架构锁

- 大容量更新锁

  允许进程将数据并发的大容量复制到同一表

## 锁的使用

- 在 读取未提交 隔离级别下，读取数据不需要加 共享锁，这样就不会跟被修改的数据上的 排他锁 冲突；

- 在 读取已提交 隔离级别下，读操作需要加 共享锁，但是在语句执行完以后释放共享锁；

- 在 可重复读 隔离级别下，读操作需要加 共享锁，但是在事务提交之前并不释放共享锁，也就是必须等待事务执行完毕以后才释放共享锁；

- 可串行化 是限制性最强的隔离级别，因为该级别 锁定整个范围的键，并一直持有锁，直到事务完成。

## 乐观锁与悲观锁

- 悲观锁：假定会发生并发冲突，屏蔽一切可能违反数据完整性的操作。利用数据库的锁机制。
- 乐观锁：假设不会发生并发冲突，只在提交操作时检查是否违反数据完整性。使用版本号机制或 CAS 算法实现。


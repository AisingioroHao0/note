# IP协议

无连接不可靠协议

主要作用：

- 寻址和路由

  IP数据报在传输过程中，每个中间节点（IP网关，路由器）只根据网络地址转发。

  如果中间节点是路由器，则路由器会根据路由表选择合适的路径。

- 分段与重组

  不同网络的数据包长度限制不同，IP给协议控制分段与组装的相关信息

## 路由器分组转发流程

- 从IP数据包提取出目的主机的IP地址，找到其所在网络

- 判断目的IP地址所在的网络是否与本路由器直接相连，如果是，则不需要与经由其他路由器，直接交付

  如果不是，检查路由表是否有目的IP地址的特定主机路由，按照路由转发到下一跳路由器中

- 无法找到合适路由返回失败

## IPv4

### 数据报格式

​                                

|版本|首部长度|服务类型|数据包长度（字节）|

|16bit标识                          |标志|13bit偏移        |

|寿命           |   上层协议    |     首部校验和          |

|                             32bit源ip地址                           |

|                             32bit目的ip地址                       |

 |                                     选项                                  |

 |                                     数据                                  |

### IPV4地址不够解决方案

- DHCP

  动态分配IP地址

- DIDR

- NAT

- ipv6

## IPv6

### 数据报格式

​                           32bit

版本  流量类型|                流标签

有效载荷程度          |       下一个首部|跳限制

源地址128bit

目的地址128bit

​         数据

- 版本

  该4bit字段用于标识ip版本号。ipv6将该字段值设为6.

  流量类型 

### 特点

- 扩大的地址容量

  - 引入任播地址

- 简化高效的40字节首部

- 流标签

  给属于特殊流的分组加上标签
# 电子邮件

三个主要组成部分：

- 用户代理
- 邮件服务器
- 简单邮件传输协议（SMTP，Simple Mail Transfer Protocol）

使用TCP可靠数据传输服务

# SMTP

用于发送方的邮件服务器发送报文到接收方的邮件服务器

## 流程

- 建立连接

  SMTP客户请求与服务器的25端口建立一个TCP连接。

  相互通告自己的域名并确认对方的域名。

- 邮件传送：

  利用命令，SMTP客户将邮件的内容传递给SMTP服务器，SMTP服务器进行响应并接收邮件

- 连接释放

  SMTP客户发出退出命令，服务器进行响应，随后关闭TCP连接。

## 流程

A向B发邮件：

- A调用邮件代理程序并提供B的邮件地址，撰写报文，然后指示用户代理发送报文
- A的用户代理把报文发给A的邮件服务器，报文被放在邮件服务器的报文队列中
- 运行在A的邮件服务器上的SMTP客户端发现了报文队列中的这个报文，它就创建一个到运行在B的邮件服务器上的SMTP服务器的TCP连接
- 经过初始SMTP握手，SMTP客户通过该TCP连接发送报文
- 在B的邮件服务器上，SMTP服务器端接受该报文，B的邮件服务器然后将该报文放入B的邮箱中
- B方便时调用用户代理阅读报文

# POP3

Post Office Protocol 因特网邮件访问协议

## 流程

当用户代理打开一个到邮件服务器端口110上的TCP连接后，POP3开始工作

- 特许

  用户代理以明文形式发送用户名和口令鉴别用户。

- 事务处理

  用户代理取回报文，并提供一些标记：删除标记，取消保温删除标记，获取邮件的统计信息。

- 更新

  当客户发出quit命令后，结束POP3会话。根据删除标记删除报文

# IMAP

IMAP服务器把每个报文与一个文件夹联系起来。

当报文第一次到达IMAP服务器时，它与收件人的INBOX文件夹相关联。

IMAP协议为用户提供了创建文件夹以及将文件从一个文件夹移动到另一个文件夹的命令。

IMAP还为用户提供了在远程文件夹中查询邮件的命令。

与POP3不同的时IMAP维护了IMAP会话的用户状态信息：例如文件夹的名字以及那些报文与哪些文件夹相关联。

具有允许用户代理获取报文某些部分的命令。

## 基于Web的电子邮件

使用HTTP完成用户浏览器与邮件服务器的传输。

邮件服务器之间的传输仍然使用SMTP。
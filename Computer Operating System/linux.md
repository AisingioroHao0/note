# linux

多用户，抢占式的多任务系统，拥有全套的unix兼容工具

## linux系统的组件

- 内核

  负责维护操作系统的所有重要抽象，包括虚拟内存和进程等。

- 系统库

  系统库定义了一个标准的函数集合，应用程序可以通过这些函数与内核交互。

- 系统工具

  系统工具程序执行单独的专业的管理任务

所有的内核代码都在处理器的特权模式下运行，并能完全访问计算机的所有物理资源。linux称这种特权模式为内核模式。

任何操作系统支持的代码如无需运行在内核模式下，则放在系统库中，并按用户模式来运行。用户模式只能访问系统资源的受控子集。

Linux系统的组件：

系统管理模式    用户进程    用户实用程序                   编译器

​                                 系统共享库

​                                 linux内核

​                                 可加载内核模块



## 内核模块

linux内核被创建成单一的单片的二进制形式。所有的内核代码和数据结构都保存在单个地址空间中，当进程调用操作系统函数时或当硬件中断被交付时，没有必要进行上下文切换。这个单一地址空间不仅包含核心调度和虚拟内存代码，而且包含所有内核代码。如设备驱动程序，文件系统和网络代码等。

linux的内核模块支持具有四个组件：

- 模块管理系统

  允许模块加载到内存，并于其他内核进行通信

- 模块加载和卸载器

  用户模式实用程序，与模块管理系统一起加载模块到内存中

- 驱动程序注册系统

  允许模块高速其余内核，新的驱动程序已经可用

- 冲突解决机制

### 模块管理

linux引用更新的处理将模块加载作业分为两个部分：

- 内核内存中的模块代码段的管理
- 允许模块引用符号的管理

linux在内核中维护一个内部符号表，就是在内核中的内部函数或变量中，可供外部引用的函数和变量的符号表。当一个模块加载到内核时，一个系统实用程序首先扫描模块以获得这些未解析的引用。利用内部符号表去解析，如果无法解析则会拒绝这个模块。

模块加载分成两个阶段：

- 模块加载器实用程序要求内核为模块预留一个连续区域的虚拟内核内存。内核返回分配内存的地址，而加载器实用程序可以采用这个地址，以重新定位模块的机器码到正确的加载地址。随后的系统调用传递这个模块和新模块想要导出任何符号表到内核。
- 内核定义了一个通信接口，以便能与模块管理程序连接。在这个连接建立后，每当进程请求设备驱动该程序，文件系统或现在尚未加载的网络服务时，内核将会通知管理程序，并会让它加载所需的哪个服务。

### 驱动程序注册


# 事务

- 标识事务开始

  ```mysql
  START TRANSACTION;
  ```

- 回滚该事务的SQL语句，也标识该事务的结束

  ```mysql
  START TRANSACTION;
  //SQL
  ROLLBACK;
  ```

- 提交该事务的SQL语句，也标识该事务结束

  ```mysql
  START TRANSACTION;
  //SQL
  COMMIT;
  ```

当COMMIT或ROLLBACK语句执行，事务会自动关闭

数据库的事务是一种机制，一个操作序列，包含了一组数据库操作命令，器质性结果必须式数据库从一种一致性状态编导另一种一致性状态。

## 特性

- 原子性

- 一致性

  多个事务对同一数据读取的结果相同

- 隔离性

  并发访问数据库时，一个用户的事务不被其他事务所干扰，哥哥事务不干涉内部的数据

- 持久性

  对数据的改变是持久的

使用日志保证原子性，一致性，持久性

使用锁来保证事务的隔离性

## 事务状态

- 活跃状态

  正在执行，所做的更改存储于主内存的缓冲区中。

- 部分提交状态

  部分执行完成，部分提交，根据主内存缓冲区

- 失败状态

  活动状态或部分提交状态发生一些错误

- 中止状态

- 提交状态

## 事务之间的相互影响

- 脏读

  一个事务读取了另一个事务未提交的数据。

  解决方法：在修改数据时，需要对数据进行加锁，避免其他事务读取到。读取已提交的隔离级别解决。

- 不可重复度读

  在一个事务范围内，两次相同的查询会返回两个不同的数据。

  原因：在两次间隙，其他事务的提交修改了某行数据。。

  可重复读的隔离级别解决。

- 幻读：

  在同一个事务范围内，表可能会突然增加新的行。
  
- 丢失更新

  相当于两个事务i=i+1，同时提交，会丢失一次增加。

## 事务隔离级别

- 读取未提交

  最低隔离级别，一个事务可以读到另一个事务未提交的结果，所有的并发问题都会发生。

  在修改数据前加锁。

- 读取已提交

  只有在事务提交后，其更新结果才会被其他事务看见。

  在读取事务前加锁，读取完毕后立刻解锁。

- 可重复读

  只可以读到事务开启前一刻的数据。

  在读取事务前加锁，事务完成后解锁。

- 可串行化

  所有事务串行执行